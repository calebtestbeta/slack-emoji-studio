<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C876YCX8BX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-C876YCX8BX');
    </script>

    <title>Emoji Studio - Professional Edition</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=M+PLUS+Rounded+1c:wght@700&family=Noto+Sans+TC:wght@700&family=Noto+Serif+TC:wght@700&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <!-- Tailwind CSS for Layout -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* --- CSS: 樣式設定 (Styles) --- */
        :root {
            --bg-main: #121212;
            --bg-sidebar: #181818;
            --bg-input: #242424;
            --accent: #6366f1;
            --border: rgba(255, 255, 255, 0.08);
            --text-muted: #888888;
        }

        body {
            background-color: var(--bg-main);
            color: #e2e8f0;
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
        }

        /* 棋盤格背景（用於預覽透明度） (Checkerboard for transparency) */
        .preview-checkerboard {
            background-image: linear-gradient(45deg, #1a1a1a 25%, transparent 25%), 
                              linear-gradient(-45deg, #1a1a1a 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #1a1a1a 75%), 
                              linear-gradient(-45deg, transparent 75%, #1a1a1a 75%);
            background-size: 16px 16px;
            background-position: 0 0, 0 8px, 8px -8px, -8px 0px;
            background-color: #141414;
            border-radius: 8px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }

        /* 自定義捲軸 (Scrollbar Customization) */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }

        /* 輸入框微調 (Input Adjustments) */
        .form-control {
            background-color: var(--bg-input);
            border: 1px solid var(--border);
            color: white;
            transition: all 0.2s;
        }
        .form-control:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        /* 滑桿樣式 (Range Slider Styles) */
        input[type="range"] {
            -webkit-appearance: none;
            height: 4px;
            background: #333;
            border-radius: 2px;
            border: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
        }

        /* 側邊欄固定效果 (Sticky Preview Logic) */
        @media (min-width: 1024px) {
            .sticky-preview-panel {
                position: sticky;
                top: 40px;
            }
        }
    </style>
</head>
<body>

    <!-- --- HTML: 頁首 (Header) --- -->
    <header class="w-full bg-[#1a1a1a] border-b border-white/5 flex justify-between items-center z-50">
        <div class="flex items-center gap-3 px-8 py-4 bg-[#181818]">
            <div class="w-8 h-8 bg-indigo-600 rounded flex items-center justify-center font-black text-white italic shadow-lg shadow-indigo-600/20">Σ</div>
            <div>
                <h1 class="text-xs font-bold tracking-widest uppercase">Emoji Studio</h1>
                <p class="text-[9px] text-gray-500 font-medium tracking-tight">PROFESSIONAL WORKSPACE / 專業工作區</p>
            </div>
        </div>
    </header>

    <!-- --- HTML: 主要內容區 (Main Content) --- -->
    <div class="max-w-[1400px] mx-auto px-6 py-8 lg:flex lg:gap-10">
        
        <!-- 左側：編輯器面板 (Editor Panel) -->
        <div class="flex-1 space-y-10 pb-20 editor-container">
            
            <!-- 文字內容設定 (Text Content) -->
            <section class="control-section">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xs font-bold uppercase tracking-widest text-indigo-400">Content / 內容設定</h2>
                    <span class="text-[10px] text-gray-500 uppercase tracking-tighter">Multiline Supported / 支援換行</span>
                </div>
                <textarea id="inputEmojiText" class="form-control w-full h-32 p-4 rounded-xl text-lg font-medium" placeholder="Enter text here... / 輸入文字... ">已閱</textarea>
            </section>

            <!-- 樣式設定區 (Styling Controls) -->
            <section class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- 字體樣式 (Typography) -->
                <div class="space-y-6">
                    <h2 class="text-xs font-bold uppercase tracking-widest text-indigo-400">Typography / 字體樣式</h2>
                    
                    <div>
                        <label class="block text-xs text-gray-500 mb-2">Font Family / 字型選擇</label>
                        <select id="selectFontFamily" class="form-control w-full p-2.5 rounded-lg text-sm">
                            <option value='"Noto Sans TC", sans-serif'>Sans-Serif / 黑體 (預設)</option>
                            <option value='"Noto Serif TC", serif'>Serif / 明體</option>
                            <option value='"Black Han Sans", sans-serif'>Heavy / 極粗黑體</option>
                            <option value='"ZCOOL KuaiLe", cursive'>Happy / 快樂體</option>
                            <option value='"M PLUS Rounded 1c", sans-serif'>Rounded / 圓體</option>
                        </select>
                    </div>

                    <div>
                        <div class="flex justify-between mb-2">
                            <label class="text-xs text-gray-500">Font Size / 字體大小</label>
                            <span id="displayFontSize" class="text-xs font-mono text-indigo-400">80px</span>
                        </div>
                        <input type="range" id="inputFontSize" min="20" max="130" value="80" class="w-full">
                    </div>
                </div>

                <!-- 外觀色彩與偏移 (Appearance) -->
                <div class="space-y-6">
                    <h2 class="text-xs font-bold uppercase tracking-widest text-indigo-400">Appearance / 外觀色彩</h2>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="color-picker-group">
                            <label class="block text-xs text-gray-500 mb-2">Text Color / 文字顏色</label>
                            <div class="flex gap-2">
                                <input type="color" id="inputTextColor" value="#ffffff" class="w-10 h-10 p-0 border-none rounded overflow-hidden">
                                <input type="text" id="inputTextColorHex" value="#ffffff" class="form-control flex-1 p-2 text-xs uppercase rounded">
                            </div>
                        </div>
                        <div class="bg-picker-group">
                            <label class="block text-xs text-gray-500 mb-2">Background / 背景顏色</label>
                            <div class="flex gap-2">
                                <input type="color" id="inputBgColor" value="#e01e5a" class="w-10 h-10 p-0 border-none rounded overflow-hidden">
                                <label class="flex-1 flex items-center justify-center gap-2 bg-[#242424] border border-white/5 rounded cursor-pointer hover:bg-[#2a2a2a] transition-colors">
                                    <input type="checkbox" id="checkTransparent" class="w-3 h-3 accent-indigo-500">
                                    <span class="text-[10px] text-gray-400">Transparent / 透明</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <label class="text-xs text-gray-500 block">Offsets (X / Y) / 位置偏移量</label>
                        <div class="flex gap-4">
                            <div class="flex-1">
                                <input type="range" id="inputOffsetX" min="-64" max="64" value="0" class="w-full" title="Horizontal Offset">
                                <div class="text-[9px] text-gray-600 mt-1 text-center">X Axis</div>
                            </div>
                            <div class="flex-1">
                                <input type="range" id="inputOffsetY" min="-64" max="64" value="0" class="w-full" title="Vertical Offset">
                                <div class="text-[9px] text-gray-600 mt-1 text-center">Y Axis</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 右側：預覽面板 (Sticky Preview) -->
        <aside class="lg:w-[360px]">
            <div class="sticky-preview-panel space-y-6">
                
                <div class="preview-card bg-[#1a1a1a] border border-white/5 rounded-2xl p-6 shadow-2xl">
                    <h2 class="text-xs font-bold uppercase tracking-widest text-indigo-400 mb-6 flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 animate-pulse"></span> Live Preview / 即時預覽
                    </h2>

                    <!-- 主畫布 (Main Canvas Preview) -->
                    <div class="preview-checkerboard w-full aspect-square flex items-center justify-center mb-8 relative group overflow-hidden">
                        <canvas id="exportCanvas" width="128" height="128" class="hidden"></canvas>
                        <img id="imageMainPreview" class="w-48 h-48 object-contain" style="image-rendering: pixelated;" alt="Main Emoji Preview">
                    </div>

                    <!-- Slack 模擬器 (Slack UI Simulation) -->
                    <div class="slack-simulation bg-black/20 rounded-xl p-4 border border-white/5 mb-8">
                        <p class="text-[9px] font-bold text-gray-600 uppercase mb-3 tracking-widest">Slack Simulation / 聊天室模擬</p>
                        <div class="flex items-start gap-3">
                            <div class="w-9 h-9 bg-gray-800 rounded flex-shrink-0"></div>
                            <div class="flex-1 space-y-2">
                                <div class="h-2 w-20 bg-gray-800 rounded"></div>
                                <div class="flex items-center gap-2 bg-[#2a2a2a] p-2 px-3 rounded-lg border border-white/5 w-fit shadow-lg">
                                    <span class="text-xs text-gray-400">Looks good!</span>
                                    <img id="imageSlackPreview" class="w-5 h-5 object-contain" alt="Slack Message Preview">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 行動按鈕 (CTA Button) -->
                    <button id="btnDownloadExport" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all active:scale-95 shadow-lg shadow-indigo-600/20 group">
                        <svg class="w-5 h-5 group-hover:translate-y-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        <span>Export PNG / 下載圖檔</span>
                    </button>
                    
                    <footer class="mt-4">
                        <p class="text-[10px] text-gray-500 text-center leading-relaxed">
                            Data stays in your browser. 100% Secure. <br>
                            您的數據不會離開瀏覽器，100% 隱私安全。<br>
                            <span class="text-[9px] opacity-60">Site analytics by Google Analytics. · 使用 Google Analytics 進行網站分析。</span>
                        </p>
                    </footer>
                </div>
            </div>
        </aside>
    </div>

    <!-- --- JS: 邏輯與互動 (Logic & Interaction) --- -->
    <script>
        /** * DOM 元素宣告 (DOM Elements Declaration)
         * 統一命名規範：[類型][功能名稱] 
         */
        const exportCanvas = document.getElementById('exportCanvas');
        const canvasCtx = exportCanvas.getContext('2d');
        const imageMainPreview = document.getElementById('imageMainPreview');
        const imageSlackPreview = document.getElementById('imageSlackPreview');
        const btnDownloadExport = document.getElementById('btnDownloadExport');

        const inputEmojiText = document.getElementById('inputEmojiText');
        const inputFontSize = document.getElementById('inputFontSize');
        const selectFontFamily = document.getElementById('selectFontFamily');
        const inputTextColor = document.getElementById('inputTextColor');
        const inputTextColorHex = document.getElementById('inputTextColorHex');
        const inputBgColor = document.getElementById('inputBgColor');
        const checkTransparent = document.getElementById('checkTransparent');
        const inputOffsetX = document.getElementById('inputOffsetX');
        const inputOffsetY = document.getElementById('inputOffsetY');
        
        const displayFontSize = document.getElementById('displayFontSize');

        /**
         * 核心渲染函式 (Core Rendering Function)
         */
        function renderEmoji() {
            const text = inputEmojiText.value;
            const size = parseInt(inputFontSize.value);
            const font = selectFontFamily.value;
            const textColor = inputTextColor.value;
            const bgColor = inputBgColor.value;
            const isTransparent = checkTransparent.checked;
            const xOffset = parseInt(inputOffsetX.value);
            const yOffset = parseInt(inputOffsetY.value);

            // 更新介面數值顯示
            displayFontSize.textContent = `${size}px`;

            // 1. 清空畫布 (Clear Canvas)
            canvasCtx.clearRect(0, 0, 128, 128);

            // 2. 繪製背景 (Draw Background)
            if (!isTransparent) {
                canvasCtx.fillStyle = bgColor;
                canvasCtx.fillRect(0, 0, 128, 128);
            }

            // 3. 設定文字樣式 (Set Text Styles)
            canvasCtx.fillStyle = textColor;
            canvasCtx.textAlign = 'center';
            canvasCtx.textBaseline = 'middle';
            canvasCtx.font = `bold ${size}px ${font}`;

            // 4. 繪製多行文字 (Draw Multiline Text)
            const lines = text.split('\n');
            lines.forEach((line, index) => {
                // 計算垂直中心點位，並加上偏移量
                const yPos = 64 + yOffset + (index - (lines.length - 1) / 2) * (size * 0.9);
                canvasCtx.fillText(line, 64 + xOffset, yPos);
            });

            // 5. 更新預覽圖檔 (Update Previews)
            const dataUrl = exportCanvas.toDataURL('image/png');
            imageMainPreview.src = dataUrl;
            imageSlackPreview.src = dataUrl;
        }

        /**
         * 事件監聽與初始化 (Event Listeners & Initialization)
         */
        const controlElements = [
            inputEmojiText, inputFontSize, selectFontFamily, 
            inputTextColor, inputBgColor, checkTransparent, 
            inputOffsetX, inputOffsetY
        ];

        controlElements.forEach(el => {
            el.addEventListener('input', renderEmoji);
        });

        // 顏色 Hex 雙向連動邏輯
        inputTextColor.addEventListener('input', (e) => {
            inputTextColorHex.value = e.target.value.toUpperCase();
        });

        inputTextColorHex.addEventListener('input', (e) => {
            const hex = e.target.value;
            if (/^#[0-9A-F]{6}$/i.test(hex)) {
                inputTextColor.value = hex;
                renderEmoji();
            }
        });

        // 下載匯出功能
        btnDownloadExport.addEventListener('click', () => {
            const fileNameSuffix = inputEmojiText.value.replace(/\s+/g, '-').slice(0, 10);
            const downloadLink = document.createElement('a');
            downloadLink.download = `emoji-${fileNameSuffix || 'studio'}.png`;
            downloadLink.href = exportCanvas.toDataURL('image/png');
            downloadLink.click();
        });

        // 頁面載入初始化
        window.addEventListener('load', () => {
            if (document.fonts) {
                document.fonts.ready.then(renderEmoji);
            } else {
                renderEmoji();
            }
        });
    </script>
</body>
</html>
